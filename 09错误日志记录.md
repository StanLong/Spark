### 一、使用spark连接外部hive报错，版本不匹配

```
Caused by: org.apache.hadoop.hive.metastore.api.MetaException: Hive Schema version 2.3.0 does not match metastore's schema version 1.2.0 Metastore is not upgraded or corrupt
```

参考: https://blog.csdn.net/qq_27882063/article/details/79886935

解决方案

方案一: 登陆mysql， 修改hive metastore版本

  ```mysql
  mysql> user hive;
  mysql> select * from VERSION;
  +--------+----------------+--------------------------------------+
  | VER_ID | SCHEMA_VERSION | VERSION_COMMENT                      |
  +--------+----------------+--------------------------------------+
  |      1 | 1.2.0          | Set by MetaStore root@192.168.235.11 |
  +--------+----------------+--------------------------------------+
  mysql> update VERSION set SCHEMA_VERSION='2.3.0' where VER_ID = 1;
  ```

方案二: 在 hive-site.xml中关闭版本验证

  ```xml
  <property>
   <name>hive.metastore.schema.verification</name>
   <value>false</value>
  </property>
  ```

第一种方法重启后就失效了，这里用第二种方法。

### 二、使用spark连接外部hive报错，元数据库信息丢失

```
21/08/25 06:49:04 WARN Query: Query for candidates of org.apache.hadoop.hive.metastore.model.MConstraint and subclasses resulted in no possible candidates Required table missing : "`KEY_CONSTRAINTS`" in Catalog "" Schema "". DataNucleus requires this table to perform its persistence operations. Either your MetaData is incorrect, or you need to enable "datanucleus.schema.autoCreateTables"
org.datanucleus.store.rdbms.exceptions.MissingTableException: Required table missing : "`KEY_CONSTRAINTS`" in Catalog "" Schema "". DataNucleus requires this table to perform its persistence operations. Either your MetaData is incorrect, or you need to enable "datanucleus.schema.autoCreateTables"
```

参考连接:

https://blog.csdn.net/BoomHankers/article/details/78925460

1. Go to the $HIVE_HOME and run the initschema option on the schematool:

   ```shell
   [root@node01 bin]# pwd
   /opt/stanlong/hive/apache-hive-1.2.2-bin/bin
   [root@node01 bin]# schematool -dbType mysql -initSchema # 执行初始化命令
   ```

2. 修改hive配置，允许自己建表建视图

   ```xml
   <property>
       <!-- <name>datanucleus.schema.autoCreateTables</name> -->
       <name>datanucleus.autoCreateTables</name>
       <value>true</value>
   </property>
   ```

   然后重启

### 三、初始化hive元数据库报错

在mysql中找到对应的hive元数据库，删除后重新执行初始化命令， **慎重执行**，删除元数据信息等于删除hive库，风险极大。

   